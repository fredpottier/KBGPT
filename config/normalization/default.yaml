# Marker Normalization Configuration - Default Tenant
#
# ADR: doc/ongoing/ADR_MARKER_NORMALIZATION_LAYER.md
#
# DOMAIN-AGNOSTIC: Ces règles sont universelles et fonctionnent
# pour tout vertical métier (software, automobile, hardware, etc.)
# Les tenants peuvent ajouter leurs propres règles spécifiques.

version: "1.0"
tenant_id: "default"

# =============================================================
# ALIASES EXACTS (priorité haute)
# Mapping direct raw_marker → canonical_form
# Utiliser quand l'Entity Anchor est DÉJÀ dans le marker
# =============================================================
aliases: {}

# =============================================================
# RÈGLES REGEX UNIVERSELLES
# Patterns avec capture groups + Entity Anchor obligatoire
# =============================================================
rules:
  # ---------------------------------------------------------
  # 1) Semantic Versioning (software, protocols, standards)
  # ---------------------------------------------------------
  - id: "semver"
    description: "vX.Y[.Z] or X.Y[.Z] (requires entity)"
    pattern: "^(v)?(\\d+)\\.(\\d+)(\\.(\\d+))?$"
    requires_entity: true
    output_template: "{entity} v{$2}.{$3}{$4}"
    priority: 20
    confidence: 0.90

  # ---------------------------------------------------------
  # 2) Revision / Rev (industry, standards, docs)
  # ---------------------------------------------------------
  - id: "revision_letter"
    description: "Rev A/B/C... (requires entity)"
    pattern: "^(Rev\\.?\\s*|Revision\\s+)([A-Z])$"
    requires_entity: true
    output_template: "{entity} Rev {$2}"
    priority: 18
    confidence: 0.88

  - id: "revision_year"
    description: "Revision YYYY (requires entity)"
    pattern: "^(Rev\\.?\\s*|Revision\\s+)(20\\d{2})$"
    requires_entity: true
    output_template: "{entity} Rev {$2}"
    priority: 17
    confidence: 0.86

  # ---------------------------------------------------------
  # 3) Generation / Mk / Mark / Gen (auto, hardware, products)
  # ---------------------------------------------------------
  - id: "generation_numeric"
    description: "Gen 2 / Generation 3 / Mk 4 / Mark II (requires entity)"
    pattern: "^(Gen(eration)?\\s+|Mk\\s+|Mark\\s+)(\\d+|[IVXLCM]+)$"
    requires_entity: true
    output_template: "{entity} Gen {$3}"
    priority: 16
    confidence: 0.85

  # ---------------------------------------------------------
  # 4) Model Year shorthand (auto common, but not domain-locked)
  # ---------------------------------------------------------
  - id: "model_year"
    description: "MY2021 / MY 2020 (requires entity)"
    pattern: "^(MY\\s?)(20\\d{2})$"
    requires_entity: true
    output_template: "{entity} MY{$2}"
    priority: 14
    confidence: 0.84

  # ---------------------------------------------------------
  # 5) Standalone numeral (high ambiguity - strong entity required)
  # NOTE: Only normalize if marker is just a numeral and entity is strong.
  # ---------------------------------------------------------
  - id: "standalone_numeral"
    description: "Standalone numeral (e.g., '3') requires entity + strong anchor"
    pattern: "^(\\d{1,3})$"
    requires_entity: true
    requires_strong_entity: true
    output_template: "{entity} {$1}"
    priority: 5
    confidence: 0.60

# =============================================================
# CONTRAINTES DE SÉCURITÉ
# =============================================================
constraints:
  # Si pas d'entity anchor → marker reste "unresolved"
  require_entity_for_ambiguous: true

  # Si plusieurs entities possibles → unresolved (pas de guess)
  single_entity_required: true

  # Seuil de confiance pour application automatique
  # En dessous = suggestion seulement (humain décide)
  auto_apply_threshold: 0.95

  # Limite du nombre d'aliases (évite explosion)
  max_aliases: 200

# =============================================================
# BLACKLIST (rejeter ces markers, jamais normaliser)
# Faux positifs universels - garder minimal
# =============================================================
blacklist:
  - "Page"
  - "Page 1"
  - "Section"
  - "Table of contents"
